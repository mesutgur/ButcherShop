@model ButcherShop.Entity.Entities.Recipe
@{
    ViewBag.Title = Model.Title;
    var relatedRecipes = ViewBag.RelatedRecipes as List<ButcherShop.Entity.Entities.Recipe>;
}

@section styles {
    <style>
        .breadcrumb-custom {
            background: var(--light-color);
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .recipe-detail-section {
            padding: 2rem 0;
        }

        .recipe-header {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 3rem;
        }

        .recipe-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }

        .recipe-meta-large {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .meta-large-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

            .meta-large-item i {
                font-size: 2rem;
                color: var(--primary-color);
            }

        .recipe-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }

        .section-box {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

            .section-box h3 {
                font-size: 1.8rem;
                font-weight: 600;
                color: var(--dark-color);
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

                .section-box h3 i {
                    color: var(--primary-color);
                }

        .ingredient-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }

            .ingredient-item:last-child {
                border-bottom: none;
            }

            .ingredient-item:hover {
                background: var(--light-color);
                padding-left: 1.5rem;
            }

            .ingredient-item .checkbox {
                width: 24px;
                height: 24px;
                border: 2px solid var(--primary-color);
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.3s;
                flex-shrink: 0;
            }

                .ingredient-item .checkbox.checked {
                    background: var(--primary-color);
                    position: relative;
                }

                    .ingredient-item .checkbox.checked::after {
                        content: "✓";
                        color: white;
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        font-weight: bold;
                    }

        .instruction-step {
            display: flex;
            gap: 1.5rem;
            padding: 1.5rem;
            background: var(--light-color);
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

            .instruction-step:hover {
                transform: translateX(5px);
                box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            }

        .step-number {
            flex-shrink: 0;
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .author-box {
            background: linear-gradient(135deg, var(--dark-color) 0%, #34495e 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
        }

            .author-box i {
                font-size: 3rem;
                margin-bottom: 1rem;
                opacity: 0.9;
            }

        .related-recipe-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

            .related-recipe-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            }

            .related-recipe-card img {
                height: 180px;
                object-fit: cover;
            }

        .product-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--light-color);
            border-radius: 20px;
            color: var(--dark-color);
            text-decoration: none;
            transition: all 0.3s;
            margin: 0.25rem;
        }

            .product-link:hover {
                background: var(--primary-color);
                color: white;
            }

        @@media (max-width: 768px) {
            .recipe-title {
                font-size: 1.8rem;
            }

            .recipe-image {
                height: 300px;
            }

            .meta-large-item {
                flex: 1 1 calc(50% - 1rem);
            }
        }
    </style>
}

<!-- Breadcrumb -->
<div class="breadcrumb-custom">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Anasayfa</a></li>
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Recipe")">Tarifler</a></li>
                <li class="breadcrumb-item active">@Model.Title</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container recipe-detail-section">
    <!-- Recipe Header -->
    <div class="recipe-header">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div>
                <h1 class="recipe-title">@Model.Title</h1>
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <p class="lead mb-0">@Model.Description</p>
                }
            </div>
            <div>
                <span class="badge bg-@(Model.DifficultyLevel == "Kolay" ? "success" : Model.DifficultyLevel == "Orta" ? "warning" : "danger") fs-5 px-4 py-2">
                    @Model.DifficultyLevel
                </span>
            </div>
        </div>

        <div class="recipe-meta-large">
            <div class="meta-large-item">
                <i class="far fa-clock"></i>
                <div>
                    <small class="text-muted d-block">Hazırlık</small>
                    <strong>@Model.PreparationTime dk</strong>
                </div>
            </div>
            <div class="meta-large-item">
                <i class="fas fa-fire"></i>
                <div>
                    <small class="text-muted d-block">Pişirme</small>
                    <strong>@Model.CookingTime dk</strong>
                </div>
            </div>
            <div class="meta-large-item">
                <i class="fas fa-clock"></i>
                <div>
                    <small class="text-muted d-block">Toplam Süre</small>
                    <strong>@(Model.PreparationTime + Model.CookingTime) dk</strong>
                </div>
            </div>
            <div class="meta-large-item">
                <i class="fas fa-users"></i>
                <div>
                    <small class="text-muted d-block">Porsiyon</small>
                    <strong>@Model.ServingSize kişilik</strong>
                </div>
            </div>
            <div class="meta-large-item">
                <i class="fas fa-eye"></i>
                <div>
                    <small class="text-muted d-block">Görüntülenme</small>
                    <strong>@Model.ViewCount</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Recipe Image -->
            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <img src="@Model.ImageUrl" alt="@Model.Title" class="recipe-image">
            }

            <!-- Kasap Ürünleri -->
            @if (Model.RecipeProducts != null && Model.RecipeProducts.Any(rp => rp.IsActive && !rp.IsDeleted))
            {
                <div class="section-box">
                    <h3><i class="fas fa-shopping-basket"></i> Kasap Ürünleri</h3>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Bu tarif için gerekli et ürünleri
                    </div>
                    @foreach (var rp in Model.RecipeProducts.Where(r => r.IsActive && !r.IsDeleted))
                    {
                        <div class="ingredient-item">
                            <div class="checkbox"></div>
                            <div class="flex-grow-1">
                                <strong>@(rp.Product != null ? rp.Product.Name : "Ürün")</strong>
                                <span class="text-danger ms-2">@rp.Quantity</span>
                            </div>
                            @if (rp.Product != null)
                            {
                                <a href="@Url.Action("Details", "Product", new { id = rp.ProductId })" class="btn btn-sm btn-outline-danger">
                                    Ürüne Git
                                </a>
                            }
                        </div>
                    }
                </div>
            }

            <!-- Diğer Malzemeler -->
            @if (!string.IsNullOrEmpty(Model.Ingredients))
            {
                <div class="section-box">
                    <h3><i class="fas fa-list"></i> Diğer Malzemeler</h3>
                    @{
                        var ingredients = Model.Ingredients.Split(new[] { "\r\n", "\n" }, StringSplitOptions.RemoveEmptyEntries);
                        foreach (var ingredient in ingredients)
                        {
                            <div class="ingredient-item">
                                <div class="checkbox"></div>
                                <div>@ingredient.TrimStart('-', ' ', '•')</div>
                            </div>
                        }
                    }
                </div>
            }

            <!-- Yapılışı -->
            <div class="section-box">
                <h3><i class="fas fa-utensils"></i> Yapılışı</h3>
                @if (!string.IsNullOrEmpty(Model.Instructions))
                {
                    var instructions = Model.Instructions.Split(new[] { "\r\n", "\n" }, StringSplitOptions.RemoveEmptyEntries);
                    int stepNumber = 1;
                    foreach (var instruction in instructions)
                    {
                        var cleanInstruction = instruction.TrimStart('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '-', ' ', '•');
                        if (!string.IsNullOrWhiteSpace(cleanInstruction))
                        {
                            <div class="instruction-step">
                                <div class="step-number">@stepNumber</div>
                                <div class="flex-grow-1">
                                    <p class="mb-0">@cleanInstruction</p>
                                </div>
                            </div>
                            stepNumber++;
                        }
                    }
                }
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Author Box -->
            <div class="author-box mb-4">
                <i class="fas fa-user-circle"></i>
                <h5 class="mb-2">Tarif Sahibi</h5>
                @if (Model.Author != null)
                {
                    <p class="mb-0">@Model.Author.FirstName @Model.Author.LastName</p>
                    <small class="text-white-50">@Model.CreatedDate.ToString("dd MMMM yyyy")</small>
                }
                else
                {
                    <p class="mb-0">Anonim</p>
                }
            </div>

            <!-- Ürünler -->
            @if (Model.RecipeProducts != null && Model.RecipeProducts.Any(rp => rp.IsActive && !rp.IsDeleted))
            {
                <div class="section-box">
                    <h5><i class="fas fa-shopping-basket me-2"></i> Bu Tarif İçin</h5>
                    <div class="d-flex flex-wrap gap-2 mt-3">
                        @foreach (var rp in Model.RecipeProducts.Where(r => r.IsActive && !r.IsDeleted))
                        {
                            if (rp.Product != null)
                            {
                                <a href="@Url.Action("Details", "Product", new { id = rp.ProductId })" class="product-link">
                                    <i class="fas fa-shopping-basket"></i>
                                    @rp.Product.Name
                                </a>
                            }
                        }
                    </div>
                </div>
            }

            <!-- İpuçları -->
            <div class="section-box">
                <h5><i class="fas fa-lightbulb me-2"></i> İpuçları</h5>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Malzemeleri önceden hazırlayın
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Eti oda sıcaklığına getirin
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Pişirme sürelerine dikkat edin
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check text-success me-2"></i>
                        Servis öncesi dinlendirin
                    </li>
                </ul>
            </div>

            <!-- Share -->
            <div class="section-box text-center">
                <h5><i class="fas fa-share-alt me-2"></i> Paylaş</h5>
                <div class="d-flex gap-2 justify-content-center mt-3">
                    <a href="#" class="btn btn-primary" title="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="btn btn-info" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="btn btn-success" title="WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="#" class="btn btn-danger" title="Pinterest">
                        <i class="fab fa-pinterest"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Recipes -->
    @if (relatedRecipes != null && relatedRecipes.Any())
    {
        <div class="row mt-5">
            <div class="col-12">
                <div class="section-title text-start">
                    <h2><i class="fas fa-book me-2"></i> Benzer Tarifler</h2>
                    <p>Aynı zorluk seviyesinde diğer tariflerimiz</p>
                </div>
            </div>

            @foreach (var recipe in relatedRecipes)
            {
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card related-recipe-card">
                        <img src="@(!string.IsNullOrEmpty(recipe.ImageUrl) ? recipe.ImageUrl : "https://via.placeholder.com/400x200?text=" + recipe.Title)"
                             class="card-img-top" alt="@recipe.Title">
                        <div class="card-body">
                            <h6 class="card-title">@recipe.Title</h6>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">
                                    <i class="far fa-clock me-1"></i> @(recipe.PreparationTime + recipe.CookingTime) dk
                                </small>
                                <span class="badge bg-@(recipe.DifficultyLevel == "Kolay" ? "success" : recipe.DifficultyLevel == "Orta" ? "warning" : "danger")">
                                    @recipe.DifficultyLevel
                                </span>
                            </div>
                            <a href="@Url.Action("Details", new { id = recipe.Id })" class="btn btn-outline-danger w-100">
                                <i class="fas fa-arrow-right me-1"></i> Tarifi Gör
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Checkbox toggle (malzeme işaretleme)
            $('.checkbox').on('click', function () {
                $(this).toggleClass('checked');
            });

            // Yazdır butonu (opsiyonel)
            $('#printRecipe').on('click', function () {
                window.print();
            });
        });
    </script>
}
